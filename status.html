<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Herdernacht SongwÃ¼nsche - Status</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyApqXsW-bTblW66DVMTw4S-dsND92-wBFQ",
      authDomain: "herder-7dd17.firebaseapp.com",
      projectId: "herder-7dd17",
      storageBucket: "herder-7dd17.firebasestorage.app",
      messagingSenderId: "472463332211",
      appId: "1:472463332211:web:6b8ea4a8d1480792a62b06",
      measurementId: "G-HR07N6LXGN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6 flex flex-col items-center">

  <h1 class="text-3xl font-bold mb-6">ðŸŽµ Bisherige SongwÃ¼nsche</h1>

    <div class="flex space-x-4 mt-8">
    <button onclick="location.href='index.html'" class="bg-blue-600 px-5 py-2 rounded hover:bg-blue-700">â¬… Zur Startseite</button>
    <button onclick="location.href='admin.html'" class="bg-green-600 px-5 py-2 rounded hover:bg-green-700">ðŸ”’ Bearbeiten (Login)</button>
  </div>

  <div id="wunschListe" class="w-full max-w-3xl space-y-4"></div>


  <script>
    const wunschListe = document.getElementById("wunschListe");

    function renderWunsch(doc) {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "bg-gray-800 p-4 rounded shadow";

      const title = document.createElement("h2");
      title.className = "text-xl font-semibold";
      title.textContent = data.title + " â€” " + data.artist;
      div.appendChild(title);

      if (data.link) {
        const link = document.createElement("a");
        link.href = data.link;
        link.target = "_blank";
        link.rel = "noopener";
        link.className = "text-blue-400 hover:underline";
        link.textContent = "Link anhÃ¶ren";
        div.appendChild(link);
      }

      if(data.comment){
        const comment = document.createElement("p");
        comment.className = "mt-2 italic text-gray-300";
        comment.textContent = "Kommentar: " + data.comment;
        div.appendChild(comment);
      }

      const status = document.createElement("p");
      status.className = "mt-2 font-semibold";

      let statusText = "Status: " + data.status.charAt(0).toUpperCase() + data.status.slice(1);

      if(data.status === "abgelehnt" && data.reason){
        statusText = "Status: Abgelehnt: " + data.reason;
        status.className += " text-red-400";
      } else if(data.status === "gespielt"){
        statusText += " âœ…";
      }

      status.textContent = statusText;
      div.appendChild(status);

      // Voting (optional)
      const votingDiv = document.createElement("div");
      votingDiv.className = "mt-3 flex items-center space-x-4";

      const upvoteBtn = document.createElement("button");
      upvoteBtn.textContent = `ðŸ‘ (${data.upvotes || 0})`;
      upvoteBtn.className = "bg-green-600 px-3 py-1 rounded hover:bg-green-700";
      upvoteBtn.onclick = async () => {
        const newUp = (data.upvotes || 0) + 1;
        await db.collection("wuensche").doc(doc.id).update({ upvotes: newUp });
        upvoteBtn.textContent = `ðŸ‘ (${newUp})`;
      };

      const downvoteBtn = document.createElement("button");
      downvoteBtn.textContent = `ðŸ‘Ž (${data.downvotes || 0})`;
      downvoteBtn.className = "bg-red-600 px-3 py-1 rounded hover:bg-red-700";
      downvoteBtn.onclick = async () => {
        const newDown = (data.downvotes || 0) + 1;
        await db.collection("wuensche").doc(doc.id).update({ downvotes: newDown });
        downvoteBtn.textContent = `ðŸ‘Ž (${newDown})`;
      };

      votingDiv.appendChild(upvoteBtn);
      votingDiv.appendChild(downvoteBtn);
      div.appendChild(votingDiv);

      wunschListe.appendChild(div);
    }

    // Echtzeit Listener, sortiert nach Zeit (neueste oben)
    db.collection("wuensche").orderBy("timestamp", "desc").onSnapshot(snapshot => {
      wunschListe.innerHTML = "";
      snapshot.forEach(doc => {
        renderWunsch(doc);
      });
    });
  </script>

</body>
</html>

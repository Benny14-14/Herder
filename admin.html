<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Herdernacht SongwÃ¼nsche - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyApqXsW-bTblW66DVMTw4S-dsND92-wBFQ",
      authDomain: "herder-7dd17.firebaseapp.com",
      projectId: "herder-7dd17",
      storageBucket: "herder-7dd17.firebasestorage.app",
      messagingSenderId: "472463332211",
      appId: "1:472463332211:web:6b8ea4a8d1480792a62b06",
      measurementId: "G-HR07N6LXGN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Hier das Admin-Passwort definieren:
    const ADMIN_PASSWORD = "deinGeheimesPasswort"; // <- Bitte anpassen
  </script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6 flex flex-col items-center">

  <div id="loginContainer" class="max-w-md w-full bg-gray-800 p-6 rounded shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Admin Login</h2>
    <form id="loginForm" class="space-y-4">
      <input type="password" id="password" placeholder="Admin Passwort" required autocomplete="off" class="w-full p-2 rounded text-black" />
      <button type="submit" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700 w-full">Anmelden</button>
    </form>
    <p id="loginError" class="text-red-500 mt-2 text-center"></p>
  </div>

  <div id="adminContent" class="hidden w-full max-w-4xl">
    <h1 class="text-3xl font-bold mb-6 text-center">ðŸŽµ Adminbereich</h1>
    <button id="logoutBtn" class="mb-6 bg-red-600 px-4 py-2 rounded hover:bg-red-700">Logout</button>
    <div id="wunschListe" class="space-y-4"></div>
  </div>

  <script>
    const loginContainer = document.getElementById("loginContainer");
    const adminContent = document.getElementById("adminContent");
    const loginForm = document.getElementById("loginForm");
    const loginError = document.getElementById("loginError");
    const logoutBtn = document.getElementById("logoutBtn");
    const wunschListe = document.getElementById("wunschListe");

    // Einfacher "Login"-Status mit SessionStorage (verlÃ¤sst Login bei Seite schlieÃŸen)
    function isLoggedIn() {
      return sessionStorage.getItem("adminLoggedIn") === "true";
    }
    function setLoggedIn(status) {
      sessionStorage.setItem("adminLoggedIn", status ? "true" : "false");
    }

    // WÃ¼nsche anzeigen
    function renderWunsch(doc) {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "bg-gray-800 p-4 rounded shadow";

      const title = document.createElement("h2");
      title.className = "text-xl font-semibold";
      title.textContent = data.title + " â€” " + data.artist;
      div.appendChild(title);

      if (data.link) {
        const link = document.createElement("a");
        link.href = data.link;
        link.target = "_blank";
        link.rel = "noopener";
        link.className = "text-blue-400 hover:underline";
        link.textContent = "Link anhÃ¶ren";
        div.appendChild(link);
      }

      if(data.comment){
        const comment = document.createElement("p");
        comment.className = "mt-2 italic text-gray-300";
        comment.textContent = "Kommentar: " + data.comment;
        div.appendChild(comment);
      }

      const status = document.createElement("p");
      status.className = "mt-2 font-semibold";
      let statusText = "Status: " + data.status.charAt(0).toUpperCase() + data.status.slice(1);
      if(data.status === "abgelehnt" && data.rejectReason){
        statusText += " (Grund: " + data.rejectReason + ")";
      } else if(data.status === "gespielt"){
        statusText += " âœ…";
      }
      status.textContent = statusText;
      div.appendChild(status);

      // LÃ¶schen Button
      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "LÃ¶schen";
      deleteBtn.className = "mt-2 bg-red-600 px-3 py-1 rounded hover:bg-red-700";
      deleteBtn.onclick = async () => {
        if(confirm("Wirklich lÃ¶schen?")){
          await db.collection("wuensche").doc(doc.id).delete();
        }
      };
      div.appendChild(deleteBtn);

      wunschListe.appendChild(div);
    }

    // Zeige Adminbereich oder Login je nach Status
    function showAppropriateView() {
      if(isLoggedIn()){
        loginContainer.classList.add("hidden");
        adminContent.classList.remove("hidden");

        // WÃ¼nsche live laden
        db.collection("wuensche").orderBy("timestamp", "desc").onSnapshot(snapshot => {
          wunschListe.innerHTML = "";
          snapshot.forEach(doc => renderWunsch(doc));
        });

      } else {
        loginContainer.classList.remove("hidden");
        adminContent.classList.add("hidden");
      }
    }

    loginForm.addEventListener("submit", e => {
      e.preventDefault();
      loginError.textContent = "";

      const pw = document.getElementById("password").value;
      if(pw === ADMIN_PASSWORD){
        setLoggedIn(true);
        showAppropriateView();
        loginForm.reset();
      } else {
        loginError.textContent = "Falsches Passwort!";
      }
    });

    logoutBtn.addEventListener("click", () => {
      setLoggedIn(false);
      showAppropriateView();
    });

    // Beim Laden prÃ¼fen
    showAppropriateView();
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Songw√ºnsche</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <div id="loginContainer" class="flex justify-center items-center h-screen">
    <form id="loginForm" class="bg-white p-8 rounded shadow-md w-80">
      <h2 class="text-2xl font-bold mb-4">Admin Login</h2>
      <input type="password" id="password" placeholder="Passwort" class="w-full p-2 border rounded mb-4">
      <button type="submit" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">Login</button>
      <p id="loginError" class="text-red-500 mt-2 hidden">Falsches Passwort</p>
    </form>
  </div>

  <div id="dashboard" class="p-6 hidden">
    <h1 class="text-3xl font-bold mb-4">üéõÔ∏è Admin-Dashboard</h1>

    <div class="mb-6">
      <label for="newSortSelect" class="mr-2 font-semibold">Sortieren (offene W√ºnsche):</label>
      <select id="newSortSelect" class="p-1 border rounded">
        <option value="neu">Neueste zuerst</option>
        <option value="alt">√Ñlteste zuerst</option>
        <option value="title">Songname</option>
        <option value="artist">Interpret</option>
        <option value="link">Mit/Ohne Link</option>
      </select>
    </div>

    <h2 class="text-xl font-semibold mb-2">Neue W√ºnsche</h2>
    <table class="w-full mb-10">
      <thead>
        <tr class="bg-gray-200 text-left">
          <th class="p-2">Titel</th>
          <th class="p-2">Interpret</th>
          <th class="p-2">Link</th>
          <th class="p-2">Grund</th>
          <th class="p-2">Aktion</th>
        </tr>
      </thead>
      <tbody id="newRequests"></tbody>
    </table>

    <div class="mb-6">
      <label for="processedSortSelect" class="mr-2 font-semibold">Sortieren (bearbeitet):</label>
      <select id="processedSortSelect" class="p-1 border rounded">
        <option value="neu">Neueste zuerst</option>
        <option value="alt">√Ñlteste zuerst</option>
        <option value="title">Songname</option>
        <option value="artist">Interpret</option>
        <option value="link">Mit/Ohne Link</option>
      </select>
    </div>

    <h2 class="text-xl font-semibold mb-2">Bearbeitete W√ºnsche</h2>
    <table class="w-full">
      <thead>
        <tr class="bg-gray-200 text-left">
          <th class="p-2">Titel</th>
          <th class="p-2">Interpret</th>
          <th class="p-2">Link</th>
          <th class="p-2">Grund</th>
          <th class="p-2">Status</th>
          <th class="p-2">Aktion</th>
        </tr>
      </thead>
      <tbody id="processedRequests"></tbody>
    </table>

    <button id="backToMainBtn" class="mt-8 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Zur√ºck zur Hauptseite</button>
  </div>

  <script>
    const PASSWORD = "herderadmin2025"; // Passwort hier anpassen

    let songs = [
      { id: 1, title: "Song A", artist: "K√ºnstler A", link: "", reason: "", status: "offen" },
      { id: 2, title: "Song B", artist: "K√ºnstler B", link: "https://youtu.be/test", reason: "", status: "offen" },
    ];

    const rejectionReasons = [
      "Unangemessen",
      "Passt nicht zur Playlist",
      "Zu laut",
      "Zuviel Bass",
      "Anderer Grund"
    ];

    const loginForm = document.getElementById('loginForm');
    const loginContainer = document.getElementById('loginContainer');
    const dashboard = document.getElementById('dashboard');
    const loginError = document.getElementById('loginError');
    const newRequests = document.getElementById('newRequests');
    const processedRequests = document.getElementById('processedRequests');
    const newSortSelect = document.getElementById('newSortSelect');
    const processedSortSelect = document.getElementById('processedSortSelect');
    const backToMainBtn = document.getElementById('backToMainBtn');

    let rejectingSongId = null;

    function createLinkHtml(link) {
      if (!link) return '-';
      return `<a href="${link}" target="_blank" class="text-blue-600 underline">Link</a>`;
    }

    function filterAndSort(list, mode) {
      if (mode === 'link') {
        return list.sort((a, b) => (b.link ? 1 : 0) - (a.link ? 1 : 0));
      }
      return list;
    }

    function sortSongs(list, mode) {
      if (mode === 'neu') return list.sort((a, b) => b.id - a.id);
      if (mode === 'alt') return list.sort((a, b) => a.id - b.id);
      if (mode === 'title') return list.sort((a, b) => a.title.localeCompare(b.title));
      if (mode === 'artist') return list.sort((a, b) => a.artist.localeCompare(b.artist));
      return list;
    }

    function renderNewRequests() {
      let newSongs = songs.filter(s => s.status === 'offen');
      newSongs = filterAndSort(newSongs, newSortSelect.value);
      newSongs = sortSongs(newSongs, newSortSelect.value);

      newRequests.innerHTML = '';

      newSongs.forEach(song => {
        const tr = document.createElement('tr');
        const isRejecting = rejectingSongId === song.id;
        tr.innerHTML = `
          <td class="p-2">${song.title}</td>
          <td class="p-2">${song.artist}</td>
          <td class="p-2">${createLinkHtml(song.link)}</td>
          <td class="p-2">${song.reason || '-'}</td>
          <td class="p-2">
            ${isRejecting ? `
              <select id="rejectReasonSelect" class="p-1 border rounded">
                ${rejectionReasons.map(r => `<option value="${r}">${r}</option>`).join('')}
              </select>
              <button id="saveRejectBtn" class="ml-2 bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">Speichern</button>
              <button id="cancelRejectBtn" class="ml-2 bg-gray-300 px-2 py-1 rounded hover:bg-gray-400">Abbrechen</button>
            ` : `
              <button class="acceptBtn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600" data-id="${song.id}">Annehmen</button>
              <button class="rejectBtn bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" data-id="${song.id}">Ablehnen</button>
              <button class="deleteBtn bg-gray-400 text-black px-2 py-1 rounded hover:bg-gray-500" data-id="${song.id}">L√∂schen</button>
            `}
          </td>
        `;
        newRequests.appendChild(tr);
      });

      newRequests.querySelectorAll('.acceptBtn').forEach(btn => {
        btn.onclick = () => {
          const id = parseInt(btn.dataset.id);
          const song = songs.find(s => s.id === id);
          if (song) {
            song.status = 'gespielt';
            renderAll();
          }
        };
      });

      newRequests.querySelectorAll('.rejectBtn').forEach(btn => {
        btn.onclick = () => {
          rejectingSongId = parseInt(btn.dataset.id);
          renderNewRequests();
        };
      });

      newRequests.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.onclick = () => {
          const id = parseInt(btn.dataset.id);
          songs = songs.filter(s => s.id !== id);
          renderAll();
        };
      });

      if (rejectingSongId !== null) {
        const saveBtn = document.getElementById('saveRejectBtn');
        const cancelBtn = document.getElementById('cancelRejectBtn');
        const reasonSelect = document.getElementById('rejectReasonSelect');

        saveBtn.onclick = () => {
          const song = songs.find(s => s.id === rejectingSongId);
          if (song) {
            song.status = 'abgelehnt';
            song.reason = reasonSelect.value;
            rejectingSongId = null;
            renderAll();
          }
        };

        cancelBtn.onclick = () => {
          rejectingSongId = null;
          renderNewRequests();
        };
      }
    }

    function renderProcessedRequests() {
      let processedSongs = songs.filter(s => s.status === 'abgelehnt' || s.status === 'gespielt');
      processedSongs = filterAndSort(processedSongs, processedSortSelect.value);
      processedSongs = sortSongs(processedSongs, processedSortSelect.value);

      processedRequests.innerHTML = '';

      processedSongs.forEach(song => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2">${song.title}</td>
          <td class="p-2">${song.artist}</td>
          <td class="p-2">${createLinkHtml(song.link)}</td>
          <td class="p-2">${song.reason || '-'}</td>
          <td class="p-2">${song.status.charAt(0).toUpperCase() + song.status.slice(1)}</td>
          <td class="p-2">
            <button class="moveToWaitingBtn bg-yellow-400 px-2 py-1 rounded hover:bg-yellow-500" data-id="${song.id}">Zur√ºck in Warteschlange</button>
            <button class="deleteBtn bg-gray-400 px-2 py-1 rounded hover:bg-gray-500" data-id="${song.id}">L√∂schen</button>
          </td>
        `;
        processedRequests.appendChild(tr);
      });

      processedRequests.querySelectorAll('.moveToWaitingBtn').forEach(btn => {
        btn.onclick = () => {
          const id = parseInt(btn.dataset.id);
          const song = songs.find(s => s.id === id);
          if (song) {
            song.status = 'offen';
            renderAll();
          }
        };
      });

      processedRequests.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.onclick = () => {
          const id = parseInt(btn.dataset.id);
          songs = songs.filter(s => s.id !== id);
          renderAll();
        };
      });
    }

    function renderAll() {
      renderNewRequests();
      renderProcessedRequests();
    }

    newSortSelect.onchange = renderNewRequests;
    processedSortSelect.onchange = renderProcessedRequests;

    loginForm.onsubmit = (e) => {
      e.preventDefault();
      const pw = document.getElementById('password').value;
      if (pw === PASSWORD) {
        loginContainer.classList.add('hidden');
        dashboard.classList.remove('hidden');
        renderAll();
        loginError.classList.add('hidden');
      } else {
        loginError.classList.remove('hidden');
      }
    };

    backToMainBtn.onclick = () => {
      window.location.href = 'index.html';
    };
  </script>

</body>
</html>

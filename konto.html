<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Konten verwalten</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Benutzerkonten</h1>
  <table border="1" id="usersTable">
    <thead>
      <tr>
        <th>UserID</th>
        <th>Benutzername</th>
        <th>Passwort</th>
        <th>Letzter Login</th>
        <th>Letzte Ã„nderung</th>
        <th>Online</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyApqXsW-bTblW66DVMTw4S-dsND92-wBFQ",
      authDomain: "herder-7dd17.firebaseapp.com",
      projectId: "herder-7dd17",
      storageBucket: "herder-7dd17.firebasestorage.app",
      messagingSenderId: "472463332211",
      appId: "1:472463332211:web:6b8ea4a8d1480792a62b06",
      measurementId: "G-HR07N6LXGN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadUsers() {
      const tbody = document.querySelector("#usersTable tbody");
      tbody.innerHTML = ""; // Tabelle leeren

      const snapshot = await db.collection("users").get();

      if(snapshot.empty) {
        tbody.innerHTML = "<tr><td colspan='6'>Keine Benutzer gefunden.</td></tr>";
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const tr = document.createElement("tr");

        // Timestamp in lesbares Datum umwandeln, falls vorhanden
        const lastLogin = data.lastLogin ? new Date(data.lastLogin.seconds * 1000).toLocaleString() : "-";
        const lastChange = data.lastChange ? new Date(data.lastChange.seconds * 1000).toLocaleString() : "-";

        tr.innerHTML = `
          <td>${doc.id}</td>
          <td>${data.username || "-"}</td>
          <td>${data.password || "-"}</td>
          <td>${lastLogin}</td>
          <td>${lastChange}</td>
          <td>${data.online ? "Ja" : "Nein"}</td>
        `;

        tbody.appendChild(tr);
      });
    }

    loadUsers();
  </script>
</body>
</html>
